"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=JSON,t={version:"1.2.117"},n="function"==typeof BigInt,r=["ab","u8","cu8","s8","u16","s16","u32","s32","u64","s64","f32","f64"];let s=null,i=null;const a=[ArrayBuffer,Uint8Array,Uint8ClampedArray,Int8Array,Uint16Array,Int16Array,Uint32Array,Int32Array,null,null,Float32Array,Float64Array],l={true:!0,false:!1,null:null,NaN:NaN,Infinity:1/0,undefined:void 0};class o extends Date{constructor(e,t){super(e),this.ns=t||0}}t.DateNS=o;const c=[];function u(){let e=c.pop();return e||(e={context:0,current_proto:null,current_class:null,current_class_field:0,arrayType:-1,valueType:0,elements:null}),e}function f(e){c.push(e)}const p=[];function g(e){p.push(e)}t.escape=function(e){let t,n="";if(!e)return e;for(t=0;t<e.length;t++)'"'!=e[t]&&"\\"!=e[t]&&"`"!=e[t]&&"'"!=e[t]||(n+="\\"),n+=e[t];return n};let h=new WeakMap,b=new Map,y=new Map,d=[];t.reset=function(){h=new WeakMap,b=new Map,y=new Map,d=[]},t.begin=function(e,t){const s={name:null,value_type:0,string:"",contains:null,className:null},i={line:1,col:1};let l,c=0,h=new Map,b=0,d=!0,m=!1,v=!1,k=null,w=null,x=void 0,_={first:null,last:null,saved:null,push(e){let t=this.saved;t?(this.saved=t.next,t.node=e,t.next=null,t.prior=this.last):t={node:e,next:null,prior:this.last},this.last?this.last.next=t:this.first=t,this.last=t,this.length++},pop(){let e=this.last;return(this.last=e.prior)||(this.first=null),e.next=this.saved,this.last&&(this.last.next=null),e.next||(e.first=null),this.saved=e,this.length--,e.node},length:0},O=[],j={},S=null,E=null,A=0,T=-1,I=0,D=0,M=!1,P=!1,C=!1,X=!1,J=!1,F={first:null,last:null,saved:null,push(e){let t=this.saved;t?(this.saved=t.next,t.node=e,t.next=null,t.prior=this.last):t={node:e,next:null,prior:this.last},this.last?this.last.next=t:this.first=t,this.last=t},shift(){let e=this.first;return e?((this.first=e.next)||(this.last=null),e.next=this.saved,this.saved=e,e.node):null},unshift(e){let t=this.saved;this.saved=t.next,t.node=e,t.next=this.first,t.prior=null,this.first||(this.last=t),this.first=t}},$=null,B=!1,U=!1,q=!1,R=!1,H=!1,z=!1,W=!1,L=0,Y=0,G=!1,V=!1,K=!1;function Q(e){throw new Error(`${e} at ${c} [${i.line}:${i.col}]`)}return{fromJSOX(e,t,n){if(h.get(e))throw new Error("Existing fromJSOX has been registered for prototype");if(t||(t=function(){}),t&&!("constructor"in t))throw new Error("Please pass a prototype like thing...");h.set(e,{protoCon:t.prototype.constructor,cb:n})},registerFromJSOX(e,t){throw new Error("registerFromJSOX is deprecated, please update to use fromJSOX instead:"+e+t.toString())},finalError(){0!==D&&(1===D&&Q("Comment began at end of document"),3===D&&Q("Open comment '/*' is missing close at end of document"),4===D&&Q("Incomplete '/* *' close at end of document")),B&&Q("Incomplete string")},value(){this.finalError();let e=k;return k=void 0,e},reset(){b=0,d=!0,F.last&&(F.last.next=F.save),F.save=F.first,F.first=F.last=null,_.last&&(_.last.next=_.save),_.length=0,_.save=F.first,_.first=_.last=null,x=void 0,I=0,O=[],j={},S=null,E=null,A=0,s.value_type=0,s.name=null,s.string="",s.className=null,i.line=1,i.col=1,v=!1,D=0,G=!1,B=!1,q=!1,R=!1,V=!1},usePrototype(e,t){j[e]=t},write(n){let r;if("string"!=typeof n&&void 0!==n&&(n=String(n)),!d)throw new Error("Parser is still in an error state, please reset before resuming");for(r=this._write(n,!1);r>0&&("function"==typeof t&&function e(n,r){let s,i,a=n[r];if(a&&"object"==typeof a)for(s in a)Object.prototype.hasOwnProperty.call(a,s)&&(i=e(a,s),void 0!==i?a[s]=i:delete a[s]);return t.call(n,r,a)}({"":k},""),k=e(k),!(r<2));r=this._write());},parse(e,t){"string"!=typeof e&&(e=String(e)),this.reset();const n=this._write(e,!0);if(n>0){let e=this.value();if(void 0===e&&n>1)throw new Error("Pending value could not complete");return e="function"==typeof t?function e(n,r){let s,i,a=n[r];if(a&&"object"==typeof a)for(s in a)Object.prototype.hasOwnProperty.call(a,s)&&(i=e(a,s),void 0!==i?a[s]=i:delete a[s]);return t.call(n,r,a)}({"":e},""):e,e}this.finalError()},_write(e,t){let j,Q,Z,ee=0;function te(e,t){throw new Error(`${e} '${String.fromCodePoint(t)}' unexpected at ${c} (near '${Z.substr(c>4?c-4:0,c>4?3:c-1)}[${String.fromCodePoint(t)}]${Z.substr(c,10)}') [${i.line}:${i.col}]`)}function ne(){s.value_type=0,s.string="",s.contains=null}function re(){let e=null;switch(s.value_type){case 5:if(!(s.string.length>13||13==s.string.length&&s[0]>"2")||V||J||X||P||(K=!0),K){if(n)return BigInt(s.string);throw new Error("no builtin BigInt()",0)}if(V){const e=s.string.match(/\.(\d\d\d\d*)/),t=e?e[1]:null;if(!t||t.length<4){const e=new Date(s.string);return isNaN(e.getTime())&&te("Bad Date format",j),e}{let e=t.substr(3);for(;e.length<6;)e+="0";const n=new o(s.string,Number(e));return isNaN(n.getTime())&&te("Bad DateNS format"+n+n.getTime(),j),n}}return(v?-1:1)*Number(s.string);case 4:if(s.className){if(e=h.get(s.className),e||(e=y.get(s.className)),e&&e.cb)return s.className=null,e.cb.call(s.string);throw new Error("Double string error, no constructor for: new "+s.className+"("+s.string+")")}return s.string;case 2:return!0;case 3:return!1;case 7:case 8:return NaN;case 9:return-1/0;case 10:return 1/0;case 1:return null;case-1:case 12:return;case 6:return s.className&&(e=h.get(s.className),e||(e=y.get(s.className)),s.className=null,e&&e.cb)?s.contains=e.cb.call(s.contains):s.contains;case 13:if(T>=0){let e;if(e=s.contains.length?N(s.contains[0]):N(s.string),0===T)return T=-1,e;{const t=new a[T](e);return T=-1,t}}if(-2===T){let e,t=w;const n=s.contains.length;for(e=0;e<n;e++){const r=s.contains[e];let i=t[r];if(!i){let r=_.first,a=0;for(;r&&a<n&&a<_.length;){const n=s.contains[a];if(!r.next||n!==r.next.node.name)break;if(r.next)if("number"==typeof n){const e=r.next.node.elements;if(e&&n>=e.length){if(a===_.length-1){console.log("This is actually at the current object so use that",a,s.contains,x),i=x,a++,r=r.next;break}if(r.next.next&&n===e.length){i=r.next.next.node.elements,r=r.next,a++,t=i;continue}i=x,a++;break}}else{if(n!==r.next.node.name){i=r.next.node.elements[n],e=a;break}i=r.next.next?r.next.next.node.elements:x}else i=i[n];r=r.next,a++}e=a<n?a-1:a}if("object"==typeof i&&!i)throw new Error("Path did not resolve properly:"+s.contains+" at "+r+"("+e+")");t=i}return T=-3,t}return s.className&&(e=h.get(s.className),e||(e=y.get(s.className)),s.className=null,e&&e.cb)?e.cb.call(s.contains):s.contains;default:console.log("Unhandled value conversion.",s)}}function se(){if(-3==T)return 6===s.value_type&&x.push(s.contains),void(T=-1);switch(s.value_type){case 12:x.push(void 0),delete x[x.length-1];break;default:x.push(re())}ne()}function ie(){if(-3===T&&13===s.value_type)return ne(),void(T=-1);if(12===s.value_type)return;!s.name&&E&&(s.name=E.fields[A++]);let e=re();S&&S.protoDef&&S.protoDef.cb?(e=S.protoDef.cb.call(x,s.name,e),e&&(x[s.name]=e)):x[s.name]=e,ne()}function ae(e){if(0!==b){switch(v&&te("Negative outside of quotes, being converted to a string (would lose count of leading '-' characters)",e),b){case 31:switch(s.value_type){case 2:s.string+="true";break;case 3:s.string+="false";break;case 1:s.string+="null";break;case 10:s.string+="Infinity";break;case 9:s.string+="-Infinity",te("Negative outside of quotes, being converted to a string",e);break;case 8:s.string+="NaN";break;case 7:s.string+="-NaN",te("Negative outside of quotes, being converted to a string",e);break;case-1:s.string+="undefined";break;case 4:case 0:break;default:console.log("Value of type "+s.value_type+" is not restored...")}break;case 1:s.string+="t";break;case 2:s.string+="tr";break;case 3:s.string+="tru";break;case 5:s.string+="f";break;case 6:s.string+="fa";break;case 7:s.string+="fal";break;case 8:s.string+="fals";break;case 9:s.string+="n";break;case 10:s.string+="nu";break;case 11:s.string+="nul";break;case 12:s.string+="u";break;case 13:s.string+="un";break;case 14:s.string+="und";break;case 15:s.string+="unde";break;case 16:s.string+="undef";break;case 17:s.string+="undefi";break;case 18:s.string+="undefin";break;case 19:s.string+="undefine";break;case 20:s.string+="N";break;case 21:s.string+="Na";break;case 22:s.string+="I";break;case 23:s.string+="In";break;case 24:s.string+="Inf";break;case 25:s.string+="Infi";break;case 26:s.string+="Infin";break;case 27:s.string+="Infini";break;case 28:s.string+="Infinit";break;case 0:case 29:case 30:break;case 32:te("String-keyword recovery fail (after whitespace)",e)}s.value_type=4,b<29&&(b=31)}else b=31,s.value_type=4;if(123==e)ce();else if(91==e)ue();else if(44==e);else{if(32==e||13==e||10==e||9==e||65279==e||8232==e||8233==e)return;44==e||125==e||93==e||58==e?te("Invalid character near identifier",e):s.string+=l}}function le(e){let t=0;for(;0==t&&c<Z.length;){l=Z.charAt(c);let n=Z.codePointAt(c++);if(n>=65536&&(l+=Z.charAt(c),c++),i.col++,n==e)q?(W?te("Incomplete hexidecimal sequence",n):z?te("Incomplete long unicode sequence",n):H&&te("Incomplete unicode sequence",n),R?(R=!1,t=1):s.string+=l,q=!1):t=1;else if(q){if(H){if(125==n){s.string+=String.fromCodePoint(L),H=!1,z=!1,q=!1;continue}if(L*=16,n>=48&&n<=57)L+=n-48;else if(n>=65&&n<=70)L+=n-65+10;else{if(!(n>=97&&n<=102)){te("(escaped character, parsing hex of \\u)",n),t=-1,H=!1,q=!1;continue}L+=n-97+10}continue}if(W||z){if(0===Y&&123===n){H=!0;continue}if(Y<2||z&&Y<4){if(L*=16,n>=48&&n<=57)L+=n-48;else if(n>=65&&n<=70)L+=n-65+10;else{if(!(n>=97&&n<=102)){te(z?"(escaped character, parsing hex of \\u)":"(escaped character, parsing hex of \\x)",n),t=-1,W=!1,q=!1;continue}L+=n-97+10}Y++,z?4==Y&&(s.string+=String.fromCodePoint(L),z=!1,q=!1):2==Y&&(s.string+=String.fromCodePoint(L),W=!1,q=!1);continue}}switch(n){case 13:R=!0,i.col=1;continue;case 8232:case 8233:i.col=1;case 10:R?R=!1:i.col=1,i.line++;break;case 116:s.string+="\t";break;case 98:s.string+="\b";break;case 110:s.string+="\n";break;case 114:s.string+="\r";break;case 102:s.string+="\f";break;case 118:s.string+="\v";break;case 48:s.string+="\0";break;case 120:W=!0,Y=0,L=0;continue;case 117:z=!0,Y=0,L=0;continue;default:s.string+=l}q=!1}else 92===n?q?(s.string+="\\",q=!1):(q=!0,L=0,Y=0):(R&&(R=!1,i.line++,i.col=2),s.string+=l)}return t}function oe(){let e;for(;(e=c)<Z.length;){l=Z.charAt(e);let n=Z.codePointAt(c++);if(n>=256){c=e;break}if(95!=n)if(i.col++,n>=48&&n<=57)C&&(J=!0),s.string+=l;else if(45==n||43==n)0==s.string.length||C&&!X&&!J?(45!=n||C||(v=!v),s.string+=l,X=!0):(v&&(s.string="-"+s.string,v=!1),s.string+=l,V=!0);else{if(78==n){if(0==b)return U=!1,void(b=20);te("fault while parsing number;",n);break}if(73==n){if(0==b)return U=!1,void(b=22);te("fault while parsing number;",n);break}if(58==n&&V)v&&(s.string="-"+s.string,v=!1),s.string+=l,V=!0;else if(84==n&&V)v&&(s.string="-"+s.string,v=!1),s.string+=l,V=!0;else if(90==n&&V)v&&(s.string="-"+s.string,v=!1),s.string+=l,V=!0;else if(46==n){if(P||M||C){d=!1,te("fault while parsing number;",n);break}s.string+=l,P=!0}else{if(110==n){K=!0;break}if(M&&(n>=95&&n<=102||n>=65&&n<=70))s.string+=l;else if(120==n||98==n||111==n||88==n||66==n||79==n){if(M||"0"!=s.string){d=!1,te("fault while parsing number;",n);break}M=!0,s.string+=l}else{if(101!=n&&69!=n){if(32==n||13==n||10==n||9==n||47==n||35==n||44==n||125==n||93==n||123==n||91==n||34==n||39==n||96==n||58==n){c=e;break}t&&(d=!1,te("fault while parsing number;",n));break}if(C){d=!1,te("fault while parsing number;",n);break}s.string+=l,C=!0}}}}t||c!=Z.length?(U=!1,s.value_type=5,0==I&&(G=!0)):U=!0}function ce(){let e,t=2,n=null,r={};if(b>0&&b<29&&ae(123),e=fe(),0==I)if(29==b||31==b&&(e||s.string.length)){if(e&&e.protoDef&&e.protoDef.protoCon&&(r=new e.protoDef.protoCon),!e||!e.protoDef&&s.string){if(n=O.find((e=>e.name===s.string)),n)m?(n.fields.length=0,t=4):(r=new n.protoCon,t=5);else{function i(){}O.push(n={name:s.string,protoCon:e&&e.protoDef&&e.protoDef.protoCon||i.constructor,fields:[]}),t=4}m=!1}E=n,b=0}else b=29;else if(29==b||1===I||3===I||5==I)if(0!=b||4==s.value_type){if(e&&e.protoDef)r=new e.protoDef.protoCon;else if(n=O.find((e=>e.name===s.string)),n)t=5,r={};else{function i(){}h.set(s.string,{protoCon:i.prototype.constructor,cb:null}),r=new i}b=0}else b=0;else if(2==I&&0==b)return te("fault while parsing; getting field name unexpected ",j),d=!1,!1;let a=u();return s.value_type=6,0===I?x=r:1==I?s.name=x.length:3!=I&&5!=I||(!s.name&&E&&(s.name=E.fields[A++]),x[s.name]=r),a.context=I,a.elements=x,a.name=s.name,a.current_proto=S,a.current_class=E,a.current_class_field=A,a.valueType=s.value_type,a.arrayType=T,a.className=s.className,s.className=null,s.name=null,S=e,E=n,A=0,x=r,w||(w=x),_.push(a),ne(),I=t,!0}function ue(){if(b>0&&b<29&&ae(91),31==b&&s.string.length){let e=r.findIndex((e=>e===s.string));b=0,e>=0?(T=e,s.className=s.string,s.string=null):"ref"===s.string?(s.className=null,T=-2):h.get(s.string)||y.get(s.string)?s.className=s.string:te(`Unknown type '${s.string}' specified for array`,j)}else if(2==I||29==b||30==b)return te("Fault while parsing; while getting field name unexpected",j),d=!1,!1;{let e=u();s.value_type=13;let t=[];if(0==I)x=t;else if(1==I)-1==T&&x.push(t),s.name=x.length;else if(3==I)if(s.name||(console.log("This says it's resolved......."),T=-3),S&&S.protoDef)if(S.protoDef.cb){const e=S.protoDef.cb.call(x,s.name,t);void 0!==e&&(t=x[s.name]=e)}else x[s.name]=t;else x[s.name]=t;e.context=I,e.elements=x,e.name=s.name,e.current_proto=S,e.current_class=E,e.current_class_field=A,e.valueType=s.value_type,e.arrayType=-1==T?-3:T,e.className=s.className,T=-1,s.className=null,s.name=null,S=null,E=null,A=0,x=t,w||(w=t),_.push(e),ne(),I=1}return!0}function fe(){const e={protoDef:null,cls:null};return((e.protoDef=h.get(s.string))||(e.protoDef=y.get(s.string)))&&(s.className||(s.className=s.string,s.string=null)),s.string&&(e.cls=O.find((e=>e.name===s.string))),e.protoDef||e.cls?e:null}if(!d)return-1;for(e&&e.length?(Q=function(){let e=p.pop();return e?e.n=0:e={buf:null,n:0},e}(),Q.buf=e,F.push(Q)):(U&&(U=!1,s.value_type=5,0==I&&(G=!0),ee=1),0!==I&&te("Unclosed object at end of stream.",j));d&&(Q=F.shift());){if(c=Q.n,Z=Q.buf,B){let e=le($);e<0?d=!1:e>0&&(B=!1,d&&(s.value_type=4))}for(U&&oe();!G&&d&&c<Z.length;)if(l=Z.charAt(c),j=Z.codePointAt(c++),j>=65536&&(l+=Z.charAt(c),c++),i.col++,D)if(1==D)if(42==j)D=3;else{if(47!=j)return te("fault while parsing;",j);D=2}else 2==D?10!=j&&13!=j||(D=0):3==D?42==j&&(D=4):D=47==j?0:3;else{switch(j){case 47:D=1;break;case 123:ce();break;case 91:ue();break;case 58:if(5==I)b=0,s.name=s.string,s.string="",s.value_type=0;else if(2==I||4==I)if(4==I){if(!Object.keys(x).length){console.log("This is a full object, not a class def...",s.className);const e=()=>{};h.set(_.last.node.current_class.name,{protoCon:e.prototype.constructor,cb:null}),x=new e,I=3,s.name=s.string,b=0,s.string="",s.value_type=0,console.log("don't do default;s do a revive...")}}else 0!=b&&31!=b&&29!=b&&30!=b&&ae(32),b=0,s.name=s.string,s.string="",I=2===I?3:6,s.value_type=0;else{if(0==I){console.log("Override colon found, allow class redefinition",I),m=!0;break}te(1==I?"(in array, got colon out of string):parsing fault;":3==I?"String unexpected":"(outside any object, got colon out of string):parsing fault;",j),d=!1}break;case 125:if(31==b&&(b=0),4==I)if(E){s.string&&E.fields.push(s.string),ne();let e=_.pop();I=0,b=0,s.name=e.name,x=e.elements,E=e.current_class,A=e.current_class_field,T=e.arrayType,s.value_type=e.valueType,s.className=e.className,w=null,f(e)}else te("State error; gathering class fields, and lost the class",j);else if(2==I||5==I){0!=s.value_type&&(E&&(s.name=E.fields[A++]),ie()),s.value_type=6,S&&S.protoDef&&(console.log("SOMETHING SHOULD AHVE BEEN REPLACED HERE??",S),console.log("The other version only revives on init"),x=new S.protoDef.cb(x,void 0,void 0)),s.contains=x,s.string="";let e=_.pop();I=e.context,s.name=e.name,x=e.elements,E=e.current_class,S=e.current_proto,A=e.current_class_field,T=e.arrayType,s.value_type=e.valueType,s.className=e.className,f(e),0==I&&(G=!0)}else if(3==I){0===s.value_type&&te("Fault while parsing; unexpected",j),ie(),s.value_type=6,s.contains=x,b=0;let e=_.pop();I=e.context,s.name=e.name,x=e.elements,S=e.current_proto,E=e.current_class,A=e.current_class_field,T=e.arrayType,s.value_type=e.valueType,s.className=e.className,f(e),0==I&&(G=!0)}else te("Fault while parsing; unexpected",j),d=!1;v=!1;break;case 93:if(b>=30&&(b=0),1==I){0!=s.value_type&&se(),s.contains=x;{let e=_.pop();s.name=e.name,s.className=e.className,I=e.context,x=e.elements,S=e.current_proto,E=e.current_class,A=e.current_class_field,T=e.arrayType,s.value_type=e.valueType,f(e)}s.value_type=13,0==I&&(G=!0)}else te(`bad context ${I}; fault while parsing`,j),d=!1;v=!1;break;case 44:b<30&&0!=b&&ae(j),31!=b&&29!=b||(b=0),4==I?E?(E.fields.push(s.string),s.string="",b=29):te("State error; gathering class fields, and lost the class",j):2==I?E?(s.name=E.fields[A++],0!=s.value_type&&(ie(),ne())):(s.string||s.value_type)&&te("State error; comma in field name and/or lost the class",j):5==I?(E?(-3==T||s.name||(s.name=E.fields[A++]),0!=s.value_type&&(-3!=T&&ie(),ne())):0!=s.value_type&&(ie(),ne()),s.name=null):1==I?(0==s.value_type&&(s.value_type=12),se(),ne(),b=0):3==I&&0!=s.value_type?(I=2,0!=s.value_type&&(ie(),ne()),b=0):(d=!1,te("bad context; excessive commas while parsing;",j)),v=!1;break;default:switch(j){default:if(0!=I&&(3!=I||29!=b)&&2!=I&&29!=b&&4!=I){if(0==b&&(j>=48&&j<=57||43==j||46==j||45==j))M=!1,C=!1,V=!1,K=!1,X=!1,J=!1,P=!1,s.string=l,Q.n=c,oe();else if(0==s.value_type)0!=b?ae(j):(b=31,s.string+=l,s.value_type=4);else if(2==I)te("Multiple values found in field name",j);else if(3==I)if(4!=s.value_type&&(6!=s.value_type&&13!=s.value_type||te("String unexpected",j),ae(j)),30==b){fe()?s.string=l:te("String unexpected",j)}else 31==b?s.string+=l:te("String unexpected",j);else if(1==I){if(30==b){s.className||(s.className=s.string,s.string=""),s.string+=l;break}31==b&&(s.string+=l)}break}switch(j){case 96:case 34:case 39:if(0==b||29==b){s.string.length&&(console.log("IN ARRAY AND FIXING?"),s.className=s.string,s.string=""),le(j)?s.value_type=4:($=j,B=!0)}else te("fault while parsing; quote not at start of field name",j);break;case 10:i.line++,i.col=1;case 13:case 32:case 8232:case 8233:case 9:case 65279:if(0===I&&31===b){b=0,0===I&&(G=!0);break}if(0===b||30===b){0==I&&s.value_type&&(G=!0);break}if(29===b){if(0===I){b=0,G=!0;break}s.string.length&&console.log("STEP TO NEXT TOKEN."),b=30}else d=!1,te("fault while parsing; whitepsace unexpected",j);break;default:if(0==b&&(j>=48&&j<=57||43==j||46==j||45==j)){M=!1,C=!1,V=!1,K=!1,X=!1,J=!1,P=!1,s.string=l,Q.n=c,oe();break}if(30===b&&(d=!1,te("fault while parsing; character unexpected",j)),0===b){b=29,s.value_type=4,s.string+=l;break}if(0==s.value_type)0!==b&&31!==b&&ae(j);else{if(31===b||29===b){s.string+=l;break}if(2==I){if(29==b){s.string+=l;break}te("Multiple values found in field name",j)}3==I&&te("String unexpected",j)}}break;case 96:case 34:case 39:s.string&&(s.className=s.string),s.string="",le(j)?(s.value_type=4,b=31):($=j,B=!0);break;case 10:i.line++,i.col=1;case 32:case 9:case 13:case 8232:case 8233:case 65279:if(31==b){if(0==I){b=0,G=!0;break}if(3==I){b=32;break}if(2==I){b=30;break}if(1==I){b=30;break}}if(0==b||30==b)break;29==b?s.string.length&&(b=30):b<31&&ae(j);break;case 116:0==b?b=1:27==b?b=28:ae(j);break;case 114:1==b?b=2:ae(j);break;case 117:2==b?b=3:9==b?b=10:0==b?b=12:ae(j);break;case 101:3==b?(s.value_type=2,b=31):8==b?(s.value_type=3,b=31):14==b?b=15:18==b?b=19:ae(j);break;case 110:0==b?b=9:12==b?b=13:17==b?b=18:22==b?b=23:25==b?b=26:ae(j);break;case 100:13==b?b=14:19==b?(s.value_type=-1,b=31):ae(j);break;case 105:16==b?b=17:24==b?b=25:26==b?b=27:ae(j);break;case 108:10==b?b=11:11==b?(s.value_type=1,b=31):6==b?b=7:ae(j);break;case 102:0==b?b=5:15==b?b=16:23==b?b=24:ae(j);break;case 97:5==b?b=6:20==b?b=21:ae(j);break;case 115:7==b?b=8:ae(j);break;case 73:0==b?b=22:ae(j);break;case 78:0==b?b=20:21==b?(s.value_type=v?7:8,v=!1,b=31):ae(j);break;case 121:28==b?(s.value_type=v?9:10,v=!1,b=31):ae(j);break;case 45:0==b?v=!v:ae(j);break;case 43:0!==b&&ae(j)}}if(G){31==b&&(b=0);break}}if(c==Z.length?(g(Q),B||U||2==I?ee=0:0!=I||0==s.value_type&&!k||(G=!0,ee=1)):(Q.n=c,F.unshift(Q),ee=2),G){w=null;break}}return d?(G&&0!=s.value_type&&(b=0,k=re(),v=!1,s.string="",s.value_type=0),G=!1,ee):-1}}};const m=[Object.freeze(t.begin())];let v=0;function k(){return this&&this.valueOf()}t.parse=function(e,n){let r,s=v++;m.length<=s&&m.push(Object.freeze(t.begin())),r=m[s],"string"!=typeof e&&(e=String(e)),r.reset();const i=r._write(e,!0);if(i>0){let e=r.value();if(void 0===e&&i>1)throw new Error("Pending value could not complete");return e="function"==typeof n?function e(t,r){let s,i,a=t[r];if(a&&"object"==typeof a)for(s in a)Object.prototype.hasOwnProperty.call(a,s)&&(i=e(a,s),void 0!==i?a[s]=i:delete a[s]);return n.call(t,r,a)}({"":e},""):e,v--,e}r.finalError()},t.defineClass=function(e,t){let n,r=Object.keys(t);for(let e=1;e<r.length;e++){let t,n;(t=r[e-1])>(n=r[e])&&(r[e-1]=n,r[e]=t,e?e-=2:e--)}d.push(n={name:e,tag:r.toString(),proto:Object.getPrototypeOf(t),fields:Object.keys(t)});for(let e=1;e<n.fields.length;e++)if(n.fields[e]<n.fields[e-1]){let t=n.fields[e-1];n.fields[e-1]=n.fields[e],n.fields[e]=t,e>1&&(e-=2)}n.proto===Object.getPrototypeOf({})&&(n.proto=null)},t.toJSOX=t.registerToJSOX=function(e,t,n){if(t.prototype&&t.prototype===Object.prototype){let r=Object.keys(t).toString();if(b.get(r))throw new Error("Existing toJSOX has been registered for object type");b.set(r,{external:!0,name:e,cb:n})}else{if(h.get(t.prototype))throw new Error("Existing toJSOX has been registered for prototype");h.set(t.prototype,{external:!0,name:e||n.constructor.name,cb:n})}},t.fromJSOX=function(e,t,n){if(t||(t=function(){}.prototype),y.get(e))throw new Error("Existing fromJSOX has been registered for prototype");if(t&&!("constructor"in t))throw new Error("Please pass a prototype like thing...");y.set(e,{protoCon:t.prototype.constructor,cb:n})},t.registerFromJSOX=function(e,t){throw new Error("deprecated; please adjust code to use fromJSOX:"+e+t.toString())},t.addType=function(e,n,r,s){t.toJSOX(e,n,r),t.fromJSOX(e,n,s)},t.registerToFrom=function(e,t){throw new Error("registerToFrom deprecated; please use addType:"+e+t.toString())},t.stringifier=function(){let n=[],r='"',a=new WeakMap;const c=[];let u=[];const f=new WeakMap,p=new Map;let g=null;const m=[];let v=!1;function w(e){return isNaN(e)?e.includes("\ufeff")||e in l||/([0-9-])/.test(e[0])||/((\n|\r|\t)|[ {}()<>!+*/.:,-])/.test(e)?r+t.escape(e)+r:e:["'",e.toString(),"'"].join("")}h.get(Object.prototype)||(h.set(Object.prototype,{external:!1,name:Object.prototype.constructor.name,cb:null}),h.set(Date.prototype,{external:!1,name:"Date",cb:function(){if(-621672192e5===this.getTime())return"0000-01-01T00:00:00.000Z";let e=-this.getTimezoneOffset(),t=e>=0?"+":"-",n=function(e){let t=Math.floor(Math.abs(e));return(t<10?"0":"")+t};return[this.getFullYear(),"-",n(this.getMonth()+1),"-",n(this.getDate()),"T",n(this.getHours()),":",n(this.getMinutes()),":",n(this.getSeconds()),"."+function(e){let t=Math.floor(Math.abs(e));return(t<100?"0":"")+(t<10?"0":"")+t}(this.getMilliseconds())+t,n(e/60),":",n(e%60)].join("")}}),h.set(o.prototype,{external:!1,name:"DateNS",cb:function(){let e=-this.getTimezoneOffset(),t=e>=0?"+":"-",n=function(e){let t=Math.floor(Math.abs(e));return(t<10?"0":"")+t};return[this.getFullYear(),"-",n(this.getMonth()+1),"-",n(this.getDate()),"T",n(this.getHours()),":",n(this.getMinutes()),":",n(this.getSeconds()),"."+function(e){let t=Math.floor(Math.abs(e));return(t<100?"0":"")+(t<10?"0":"")+t}(this.getMilliseconds())+function(e){let t=Math.floor(Math.abs(e));return(t<1e5?"0":"")+(t<1e4?"0":"")+(t<1e3?"0":"")+(t<100?"0":"")+(t<10?"0":"")+t}(this.ns)+t,n(e/60),":",n(e%60)].join("")}}),h.set(Boolean.prototype,{external:!1,name:"Boolean",cb:k}),h.set(Number.prototype,{external:!1,name:"Number",cb:function(){return isNaN(this)?"NaN":isFinite(this)?String(this):this<0?"-Infinity":"Infinity"}}),h.set(String.prototype,{external:!1,name:"String",cb:function(){return'"'+t.escape(k.apply(this))+'"'}}),"function"==typeof BigInt&&h.set(BigInt.prototype,{external:!1,name:"BigInt",cb:function(){return this+"n"}}),h.set(ArrayBuffer.prototype,{external:!0,name:"ab",cb:function(){return"["+w(_(this))+"]"}}),h.set(Uint8Array.prototype,{external:!0,name:"u8",cb:function(){return"["+w(_(this.buffer))+"]"}}),h.set(Uint8ClampedArray.prototype,{external:!0,name:"uc8",cb:function(){return"["+w(_(this.buffer))+"]"}}),h.set(Int8Array.prototype,{external:!0,name:"s8",cb:function(){return"["+w(_(this.buffer))+"]"}}),h.set(Uint16Array.prototype,{external:!0,name:"u16",cb:function(){return"["+w(_(this.buffer))+"]"}}),h.set(Int16Array.prototype,{external:!0,name:"s16",cb:function(){return"["+w(_(this.buffer))+"]"}}),h.set(Uint32Array.prototype,{external:!0,name:"u32",cb:function(){return"["+w(_(this.buffer))+"]"}}),h.set(Int32Array.prototype,{external:!0,name:"s32",cb:function(){return"["+w(_(this.buffer))+"]"}}),h.set(Float32Array.prototype,{external:!0,name:"f32",cb:function(){return"["+w(_(this.buffer))+"]"}}),h.set(Float64Array.prototype,{external:!0,name:"f64",cb:function(){return"["+w(_(this.buffer))+"]"}}),h.set(Float64Array.prototype,{external:!0,name:"f64",cb:function(){return"["+w(_(this.buffer))+"]"}}),h.set(RegExp.prototype,i={external:!0,name:"regex",cb:function(e,t){return"'"+escape(this.source)+"'"}}),y.set("regex",{protoCon:RegExp,cb:function(e,t){return new RegExp(this)}}),h.set(Map.prototype,i={external:!0,name:"map",cb:null}),y.set("map",{protoCon:Map,cb:function(e,t){if(!e)return this;this.set(e,t)}}),h.set(Array.prototype,s={external:!1,name:Array.prototype.constructor.name,cb:null}));const x={defineClass(e,t){let r,s=Object.keys(t);for(let e=1;e<s.length;e++){let t,n;(t=s[e-1])>(n=s[e])&&(s[e-1]=n,s[e]=t,e?e-=2:e--)}n.push(r={name:e,tag:s.toString(),proto:Object.getPrototypeOf(t),fields:Object.keys(t)});for(let e=1;e<r.fields.length;e++)if(r.fields[e]<r.fields[e-1]){let t=r.fields[e-1];r.fields[e-1]=r.fields[e],r.fields[e]=t,e>1&&(e-=2)}r.proto===Object.getPrototypeOf({})&&(r.proto=null)},setDefaultObjectToJSOX(e){g=e},isEncoding:e=>!!u.find(((t,n)=>t===e&&n<u.length-1)),encodeObject(e){return g?g.apply(e,[this]):e},stringify:(e,t,r)=>function(e,t,r){if(void 0===e)return"undefined";if(null===e)return;let l,o,y,k;const _=typeof r,j=typeof t;if(l="",o="","number"===_)for(k=0;k<r;k+=1)o+=" ";else"string"===_&&(o=r);if(y=t,t&&"function"!==j&&("object"!==j||"number"!=typeof t.length))throw new Error("JSOX.stringify");c.length=0,a=new WeakMap;const S=E("",{"":e});return d.length=0,S;function E(e,t){var r=l;const a=s.cb,k=i.cb;s.cb=j,i.cb=S;const _=A(e,t);return s.cb=a,i.cb=k,_;function j(){let e,t=[],n=c.length;for(let e=0;e<this.length;e+=1)c[n]=e,t[e]=E(e,this)||"null";return c.length=n,u.length=n,e=0===t.length?"[]":l?["[\n",l,t.join(",\n"+l),"\n",r,"]"].join(""):"["+t.join(",")+"]",e}function S(){let e={tmp:null},t="{",n=!0;for(let[r,s]of this){e.tmp=s;let i=c.length;c[i]=r,t+=(n?"":",")+w(r)+":"+E("tmp",e),c.length=i,n=!1}return t+="}",t}function A(e,t){let s,i,a,k,_,j,S,A=c.length,T=!0,I=t[e],D="object"==typeof I;D&&null!==I&&g&&(m.find((e=>e===I))||(m.push(I),u[A]=I,T=!1,I=g.apply(I,[x]),D="object"==typeof I,m.pop(),u.length=A,D="object"==typeof I));const M=null!=I&&Object.getPrototypeOf(I);let P=M&&(f.get(M)||h.get(M)||null),C=!P&&null!=I&&(p.get(Object.keys(I).toString())||b.get(Object.keys(I).toString())||null);"function"==typeof y&&(T=!1,I=y.call(t,e,I));let X=P&&P.cb||C&&C.cb;if(null!=I&&"object"==typeof I&&"function"==typeof X)if(m.find((e=>e===I)))a=N(I);else{if("object"==typeof I&&(a=N(I),a))return a;m.push(I),u[A]=I,I=X.call(I,x),T=!1,m.pop(),P&&P.name&&"string"==typeof I&&"-"!==I[0]&&(I[0]<"0"||I[0]>"9")&&'"'!==I[0]&&"'"!==I[0]&&"`"!==I[0]&&"["!==I[0]&&"{"!==I[0]&&(I=" "+I),u.length=A}else if("object"==typeof I&&(a=N(I),a))return a;switch(typeof I){case"bigint":return I+"n";case"string":{I=T?w(I):I;let t="";return""===e&&(t=n.map((e=>e.name+"{"+e.fields.join(",")+"}")).join(l?"\n":"")+d.map((e=>e.name+"{"+e.fields.join(",")+"}")).join(l?"\n":"")+(l?"\n":"")),P&&P.external?t+P.name+I:C&&C.external?t+C.name+I:t+I}case"number":case"boolean":case"null":return String(I);case"object":if(a)return"ref"+a;if(!I)return"null";if(l+=o,_=null,j=[],y&&"object"==typeof y){for(k=y.length,_=O(I,y),s=0;s<k;s+=1)"string"==typeof y[s]&&(i=y[s],c[A]=i,a=E(i,I),a&&(_?j.push(a):j.push(w(i)+(l?": ":":")+a)));c.splice(A,1)}else{_=O(I);let e=[];for(i in I)if((!v||Object.prototype.propertyIsEnumerable.call(I,i))&&Object.prototype.hasOwnProperty.call(I,i)){let t;for(t=0;t<e.length;t++)if(e[t]>i){e.splice(t,0,i);break}t==e.length&&e.push(i)}for(let t=0;t<e.length;t++)i=e[t],Object.prototype.hasOwnProperty.call(I,i)&&(c[A]=i,a=E(i,I),a&&(_?j.push(a):j.push(w(i)+(l?": ":":")+a)));c.splice(A,1)}S=""===e?(n.map((e=>e.name+"{"+e.fields.join(",")+"}")).join(l?"\n":"")||d.map((e=>e.name+"{"+e.fields.join(",")+"}")).join(l?"\n":""))+(l?"\n":""):"",P&&P.external&&(S+=w(P.name));let t=null;return _&&(t=w(_.name)),a=S+(0===j.length?"{}":l?(_?t:"")+"{\n"+l+j.join(",\n"+l)+"\n"+r+"}":(_?t:"")+"{"+j.join(",")+"}"),l=r,a}}}}(e,t,r),setQuote(e){r=e},registerToJSOX(e,t,n){return this.toJSOX(e,t,n)},toJSOX(e,t,n){if(t.prototype&&t.prototype!==Object.prototype){if(f.get(t.prototype))throw new Error("Existing toJSOX has been registered for prototype");f.set(t.prototype,{external:!0,name:e||n.constructor.name,cb:n})}else{let r=Object.keys(t).toString();if(p.get(r))throw new Error("Existing toJSOX has been registered for object type");p.set(r,{external:!0,name:e,cb:n})}},get ignoreNonEnumerable(){return v},set ignoreNonEnumerable(e){v=e}};return x;function N(t){if(null===t)return;let n=a.get(t);if(n)return"ref"+n;a.set(t,e.stringify(c))}function O(e,t){let r,s,i=Object.getPrototypeOf(e);if(s=n.find((e=>{if(e.proto&&e.proto===i)return!0})),s)return s;if(n.length||d.length){if(t)t=t.map((e=>"string"==typeof e?e:void 0)),r=t.toString();else{let t=Object.keys(e);for(let e=1;e<t.length;e++){let n,r;(n=t[e-1])>(r=t[e])&&(t[e-1]=r,t[e]=n,e?e-=2:e--)}r=t.toString()}s=n.find((e=>{if(e.tag===r)return!0})),s||(s=d.find((e=>{if(e.tag===r)return!0})))}return s}};const w="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789$_",x={"~":-1,"=":-1,$:62,_:63,"+":62,"-":62,".":62,"/":63,",":63};for(let e=0;e<256;e++)e<64&&(x[w[e]]=e);function _(e){let t,n,r,s,i,a="",l=new Uint8Array(e),o=l.byteLength,c=o%3,u=o-c;for(let e=0;e<u;e+=3)i=l[e]<<16|l[e+1]<<8|l[e+2],t=(16515072&i)>>18,n=(258048&i)>>12,r=(4032&i)>>6,s=63&i,a+=w[t]+w[n]+w[r]+w[s];return 1==c?(i=l[u],t=(252&i)>>2,n=(3&i)<<4,a+=w[t]+w[n]+"=="):2==c&&(i=l[u]<<8|l[u+1],t=(64512&i)>>10,n=(1008&i)>>4,r=(15&i)<<2,a+=w[t]+w[n]+w[r]+"="),a}function N(e){let t;t=e.length%4==1?3*((e.length+3)/4|0)-3:e.length%4==2?3*((e.length+3)/4|0)-2:e.length%4==3?3*((e.length+3)/4|0)-1:-1==x[e[e.length-3]]?3*((e.length+3)/4|0)-3:-1==x[e[e.length-2]]?3*((e.length+3)/4|0)-2:-1==x[e[e.length-1]]?3*((e.length+3)/4|0)-1:3*((e.length+3)/4|0);let n,r=new ArrayBuffer(t),s=new Uint8Array(r),i=e.length+3>>2;for(n=0;n<i;n++){let t=x[e[4*n]],r=4*n+1<e.length?x[e[4*n+1]]:-1,i=r>=0&&4*n+2<e.length?x[e[4*n+2]]:-1,a=i>=0&&4*n+3<e.length?x[e[4*n+3]]:-1;r>=0&&(s[3*n+0]=t<<2|r>>4),i>=0&&(s[3*n+1]=r<<4|i>>2&15),a>=0&&(s[3*n+2]=i<<6|63&a)}return r}Object.freeze(x),t.stringify=function(e,n,r){return t.stringifier().stringify(e,n,r)};[[0,256,[16767487,16739071,130048,3670016,0,16777208,16777215,8388607]]].map((e=>({firstChar:e[0],lastChar:e[1],bits:e[2]})));exports.JSOX=t;
